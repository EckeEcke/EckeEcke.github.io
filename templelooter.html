<html>

<head>
    <style>


        @font-face {
            font-family: pixelFont;
            src: url("css/joystix.ttf")
        }

        body {
            background-color: black;
            font-family: "pixelFont";
        }

        h1 {
            font-family: pixelFont;
            text-align: center;
            color: white;
            margin-top: 5%;
        }

        #hamburger {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: rgb(0, 0, 0, 0.7);
            padding: 5px;
            z-index: 3000;
            border-style: none;
        }

        .line1,
        .line2,
        .line3 {
            width: 40px;
            height: 6px;
            margin: 8px;
            background-color: white;
            border-radius: 20px;
        }



        #burger-menu {

            position: fixed;
            background-color: white;
            opacity: 0.96;
            right: 0px;
            top: 0px;
            padding: 100px 80px 100px 0px;
            z-index: -3000;
            height: 0vh;
            border-left: 1px solid black;
            transition: 0.5s;
            opacity: 0;
        }

        #burger-menu a {
            text-decoration: none;
            color: black;
            font-size: 1.3em;
        }

        #burger-menu li {
            list-style: none;
        }

        #burger-menu a:hover {
            color: #039BE5;
            transition: 0.5s;
        }

        .nav-line {
            background-color: white;
            height: 2px;
        }
    </style>
</head>

<body>

    <button id="hamburger" onclick="showMenu()">
        <div class="line1"></div>
        <div class="line2"></div>
        <div class="line3"></div>
    </button>
    <div id="burger-menu" show="false">
        <ul>
            <li>
                <a href="index.html">Home</a>
            </li>
            <hr class="nav-line">
            <li>
                <a href="https://nifty-hopper-c1da01.netlify.app/" target="_blank">React Travel Blog</a>
            </li>
            <hr class="nav-line">
            <li>
                <a href="shooter.html">JS Space Shooter</a>
            </li>
            <hr class="nav-line">
            <li>
                <a href="pong.html">JS Pong</a>
            </li>
            <hr class="nav-line">
            <li>
                <a href="https://adoring-galileo-71fde2.netlify.app/">React Todo App</a>
            </li>
            <hr class="nav-line">
            <li>
                <a href="newgame.html">Drawing App</a>
            </li>
            <hr class="nav-line">
            <li>
                <a href="templelooter.html">Temple Looter</a>
            </li>
        </ul>
    </div>

    <h1>Temple Looter</h1>
    <canvas id="game-canvas" style="display: block;margin: 100px auto"></canvas>
    <img src="images/treasure.png" id="treasure" style="display:none">
    <img src="images/dungeon-background2.png" id="background" style="display:none">
    <img src="images/dungeon-wall.png" id="wall" style="display:none">
    <img src="images/character1.png" id="character1" style="display:none">
    <img src="images/character2.png" id="character2" style="display:none">

    <script>
        const canvas = document.getElementById("game-canvas");
        const ctx = canvas.getContext("2d");
        let aPressed, sPressed, wPressed, dPressed, spacePressed = false;


        let squareX = 0;
        let squareY = 0;
        let squareWidth;
        let squareHeight;
        let obstacleX;
        let obstacleY;
        let obstacleY2;
        const obstacleWidth = 30;
        let obstacleHeight;
        let isCollision;
        let isCollisionY;
        let kickback;
        let kickbackY;

        let treasureX;
        let treasureY;
        let treasureCollected;

        let passedGate;
        let score;

        let gameSpeed;

        let gatesPassed;

        let strikes;

        let character;

        let characterSprite;

        let characterAnimation;

        let gameInterval;




        window.onload = function () {
            canvas.width = 400;
            canvas.height = 400;
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.textAlign = "center";
            ctx.font = "20px pixelFont";
            ctx.fillStyle = "white";
            ctx.fillText("Press space to start", canvas.width / 2, 300);
            ctx.fillText("Controls", canvas.width / 2, 70);
            ctx.fillText("W = UP", canvas.width / 2, 120);
            ctx.fillText("A = Left", canvas.width / 2, 150);
            ctx.fillText("D = Right", canvas.width / 2, 180);
            ctx.fillText("S = DOWN", canvas.width / 2, 210);
            document.addEventListener("keydown", keyDownHandler, false);
            document.addEventListener("keyup", keyUpHandler, false);
            characterAnimation = setInterval(animateCharacter, 200);
            document.addEventListener("keydown", event => {
                if (event.keyCode === 32 && !spacePressed) {
                    startGame();
                }
            });
        }

        function startGame() {
            initialize();
            gameInterval = setInterval(callAll, 1000 / gameSpeed);
            spacePressed = true;
            console.log(gameInterval);
        }

        function initialize() {
            squareX = 0;
            squareY = canvas.height / 2;
            obstacleX = canvas.width + 10;
            obstacleY = 0;
            obstacleHeight = 25 * Math.floor(Math.random() * 10);
            isCollision = false;
            isCollisionY = false;
            treasureX = 10 + Math.floor(Math.random() * 200);
            treasureY = 50;
            treasureCollected = false;
            passedGate = false;
            score = 0;
            gameSpeed = 120;
            gatesPassed = 0;
            strikes = 3;
            character = true;
            characterSprite = document.getElementById("character2");
        }


        function callAll() {


            ctx.webkitImageSmoothingEnabled = false;
            ctx.mozImageSmoothingEnabled = false;
            ctx.imageSmoothingEnabled = false;
            ctx.drawImage(document.getElementById("background"), 0, 0, canvas.width, canvas.height);
            drawSquare();
            moveSquare();


            collision();
            countPoints();
            ctx.fillStyle = "white";
            ctx.font = "20px pixelFont";
            ctx.textAlign = "start";
            ctx.fillText("Score: " + score, 0, 24);
            drawStrikes();
            drawTreasure();
            collectTreasure();
            drawObstacle();
            endGame();

        }

        function drawSquare() {
            squareHeight = canvas.height / 10;
            squareWidth = canvas.width / 10;
            let squareColor = "red";
            ctx.drawImage(characterSprite, squareX, squareY);
        }

        function moveSquare() {
            if (aPressed && squareX > 0) {
                if (squareX > obstacleX + obstacleWidth && squareX < obstacleX + obstacleWidth) {
                    squareX == obstacleX + obstacleWidth;
                } else {
                    squareX -= 2;
                }

            }
            if (dPressed && squareX < 9 * canvas.width / 10 && !isCollision) {
                squareX += 2;
            }
            if (wPressed && squareY > 0) {
                squareY -= 2;
            }
            if (sPressed && squareY < 9 * canvas.height / 10) {
                squareY += 2;
            }
            if (isCollision && kickback < 0) {
                squareX += kickback;
                kickback -= 1;
                if (kickback == -12) {
                    isCollision = false;
                }
            }
            if (isCollision && kickback > 0) {
                squareX += kickback;
                kickback += 1;
                if (kickback == 12) {
                    isCollision = false;
                }

            }
            if (isCollisionY && kickbackY > 0) {
                squareY += kickbackY;
                kickbackY += 1;
                if (kickbackY == 6) {
                    isCollisionY = false;
                    kickbackY = 0;
                }
            }
            if (isCollisionY && kickbackY < 0) {
                squareY += kickbackY;
                kickbackY -= 1;
                console.log(kickbackY)
                if (kickbackY == -6) {
                    isCollisionY = false;
                    kickbackY = 0;
                }
            }
        }

        function keyDownHandler(event) {
            if (event.keyCode === 65) {
                aPressed = true;
            }
            else if (event.keyCode === 68) {
                dPressed = true;
            }
            else if (event.keyCode === 87) {
                wPressed = true;
            }
            else if (event.keyCode === 83) {
                sPressed = true;
            }

        }


        function keyUpHandler(event) {
            if (event.keyCode === 65) {
                aPressed = false;
            }
            else if (event.keyCode === 68) {
                dPressed = false;
            }
            else if (event.keyCode === 87) {
                wPressed = false;
            }
            else if (event.keyCode === 83) {
                sPressed = false;
            }

        }

        function animateCharacter() {
            character = !character;
            characterSprite = (character == true) ? document.getElementById("character2") : characterSprite = document.getElementById("character1");

        }

        function drawTreasure() {

            if (!treasureCollected) {
                ctx.webkitImageSmoothingEnabled = false;
                ctx.mozImageSmoothingEnabled = false;
                ctx.imageSmoothingEnabled = false;
                ctx.drawImage(document.getElementById("treasure"), treasureX, treasureY, 40, 40);
            }

        }
        function drawObstacle() {

            obstacleY2 = obstacleHeight + 60;
            ctx.webkitImageSmoothingEnabled = false;
            ctx.mozImageSmoothingEnabled = false;
            ctx.imageSmoothingEnabled = false;
            ctx.drawImage(document.getElementById("wall"), obstacleX, 0, obstacleWidth, obstacleHeight);
            ctx.drawImage(document.getElementById("wall"), obstacleX, obstacleY2, obstacleWidth, canvas.height);
            ctx.fillStyle = "green";
            obstacleX -= 1;
            if (obstacleX < -30) {
                obstacleX = canvas.width + 50;
                obstacleHeight = 25 * Math.floor(Math.random() * 10);
                passedGate = false;
                treasureX = 20 + Math.floor(Math.random() * 200);
                treasureY = 20 + Math.floor(Math.random() * 350);
                treasureCollected = false;
            }

        }



        function collision() {
            if (obstacleX < squareX + squareWidth && obstacleX > squareX + squareWidth - 4 && squareY < obstacleY + obstacleHeight - 2) {
                console.log("collision");
                isCollision = true;
                kickback = -4;
                console.log("collision1");
                strikes -= 1;
            }
            if (obstacleX < squareX + squareWidth && obstacleX >= squareX + squareWidth - 4 && obstacleY2 < squareY + squareHeight) {
                console.log("collision");
                isCollision = true;
                kickback = -4;
                console.log("collision2");
                strikes -= 1;
            }



            if (squareX < obstacleX + obstacleWidth && squareX + squareWidth > obstacleX && squareY <= obstacleY + obstacleHeight && squareY >= obstacleY + obstacleHeight - 2) {
                isCollisionY = true;
                kickbackY = 4;
            }
            if (squareX < obstacleX + obstacleWidth && squareX + squareWidth > obstacleX && squareY < obstacleY2 + 2 && squareY + squareHeight > obstacleY2) {
                isCollisionY = true;
                kickbackY = -4;
            }
            if (passedGate) {
                if (squareX < obstacleX + obstacleWidth) {
                    squareX = obstacleX + obstacleWidth;
                }
            }
        }

        function collectTreasure() {
            if (squareX < treasureX + 40 && squareX + squareWidth > treasureX && squareY < treasureY + 40 && squareY + squareHeight > treasureY && !treasureCollected) {
                treasureCollected = true;
                score += 20;
                console.log("treasure");
            }
        }

        function drawStrikes() {
            ctx.fillStyle = "red";
            ctx.font = "30px pixelFont";
            if (strikes == 1) {
                text = "❤♡♡"
            }

            if (strikes == 2) {

                text = "❤❤♡";
            }

            if (strikes == 3) {
                text = "❤❤❤";
            }
            ctx.fillText(text, 3 / 4 * canvas.width - 10, 28);
        }


        function endGame() {
            if (squareX + squareWidth < -30 || strikes === 0) {
                clearInterval(gameInterval);
                ctx.fillStyle = "black";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "white";
                ctx.font = "30px pixelFont";
                ctx.textAlign = "center";
                ctx.fillText("Game Over", canvas.width / 2, canvas.height / 2 - 50);
                ctx.font = "20px pixelFont";
                ctx.fillText("Your score: " + score, canvas.width / 2, canvas.height / 2 + 50);
                ctx.fillText("Press space for retry", canvas.width / 2, canvas.height / 2 + 100);
                spacePressed = false;
                console.log(spacePressed);
            }


        }

        function countPoints() {
            if (squareX > obstacleX + 10 && !passedGate) {
                gatesPassed += 1;
                passedGate = true;
            }
            if (gatesPassed == 5) {
                gatesPassed = 0;
                gameSpeed = 1.2 * gameSpeed;
                clearInterval(gameInterval);
                gameInterval = setInterval(callAll, 1000 / gameSpeed);
                console.log(gameSpeed);
            }
        }

        const burgerMenu = document.getElementById("burger-menu");
        let burgerMenuShowing = false;

        function showMenu() {
            burgerMenuShowing = !burgerMenuShowing;
            if (burgerMenuShowing) {
                burgerMenu.style.height = "100vh";
                burgerMenu.style.opacity = "0.99";
                burgerMenu.style.zIndex = "2500";
                hamburger.style.position = "fixed";
            }
            else {
                burgerMenu.style.height = "0vh";
                burgerMenu.style.opacity = "0";
                burgerMenu.style.zIndex = "-3000";
                hamburger.style.position = "absolute";
            }
        }


    </script>
</body>

</html>