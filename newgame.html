<html>

    <head>
        <meta name="viewport" content="width=device-width, maximum-scale=1.0">
        <style>
        * {
            color:white;
            font-family: Helvetica;
        }

        body {
            background-image: linear-gradient(to right, #7b4397, #dc2430);
        }

        table {
            width: 300px;
            text-align: center;
        }

        select {
            color: black;
            width: 32px;
            height:28px;
            text-align: center;
            vertical-align: middle;
        }

        option {
            color: black;
        }

        #color-select {
            width: 36px;
            height: 40px;
            background-color: transparent;
            border: 0;
        }

        img {
            width: 30px;
            height: 30px;
            vertical-align: middle;
        }

        #color-img {
            margin-left: 8px;
            width: 30px;
            height: 30px;
        }

        #width-img {
            width: 26px;
            height: 26px;
        }

        #rainbow-img {
            width: 40px;
            height: 40px;
        }

        #rainbow-checkbox {
            margin-right: 8px;
        }

        input {
            vertical-align: middle;
        }

        div div{
            display: inline-block;
        }

        </style>

    </head>

    <body>
        <center>
            <br>
            <h1>Drawing App</h1>

        
            
            <br>
        
            <canvas id="game-canvas" width="300px" height="400px">

            </canvas>

            <div style="width: 300px; display: flex; flex-direction: row; justify-content: space-between; align-items: baseline; background-color: white; border-top: 1px solid grey;">
                <div>
                    <img src="images/color-circle.svg" id="color-img">
                    <input id="color-select" type="color" value="#0A1172"></input>
                </div>
                <div>
                    <img src="images/width.svg" id="width-img"> 
                    <select id="line-width">
                        <option value="2">2</option>
                        <option value="4">4</option>
                        <option value="6">6</option>
                        <option value="8">8</option>
                        <option value="10">10</option>
                    </select>
                </div>
                <div>
                    <img src="images/rainbow.svg" id="rainbow-img">
                    <input id="rainbow-checkbox" type="checkbox">
                </div>
            </div>

        </center>
        
        
        

        

        

        <script>

            let p1X;
            let p1Y;
            const colorSelect = document.getElementById("color-select");
            const lineSelect = document.getElementById("line-width");
            const rainbowCheckbox = document.getElementById("rainbow-checkbox");

            let isDrawing = false;

            const canvas = document.getElementById("game-canvas");
            const canvasContext = canvas.getContext("2d");

            canvasContext.fillStyle = "white";
            canvasContext.fillRect(0,0,canvas.width,canvas.height);

            

            window.onload = function () {
                canvas.addEventListener("mousedown", setDrawing);
                canvas.addEventListener("mousemove", draw);
                canvas.addEventListener("touchstart", setDrawing);
                canvas.addEventListener("touchmove", draw);
                canvas.addEventListener("mouseup", stopDrawing);
                canvas.addEventListener("touchend", stopDrawing);
            };

    

            function setDrawing(event){
                event.preventDefault();
                isDrawing = true;
                let rect = event.target.getBoundingClientRect();
                p1X = (event.targetTOuches ? event.targetTouches[0].pageX - rect.left : event.offsetX);
                p1Y = (event.targetTouches ? event.targetTouches[0].pageY - rect.top : event.offsetY);
                console.log("setDrawing works");
            }

            function draw(event){
                event.preventDefault();
                if(isDrawing){
                    let rect = event.target.getBoundingClientRect();
                    let x = (event.targetTouches ? event.targetTouches[0].pageX - rect.left : event.offsetX);
                    let y = (event.targetTouches ? event.targetTouches[0].pageY - rect.top : event.offsetY);
                    drawLine(canvasContext, p1X, p1Y, x, y);
                    p1X = (event.targetTouches ? event.targetTouches[0].pageX - rect.left : event.offsetX);
                    p1Y = (event.targetTouches ? event.targetTouches[0].pageY - rect.top : event.offsetY);
                    console.log(event.offsetX);
                }
            }

            function drawLine(context, x1, y1, x2, y2) {
                let color = colorSelect.value;
                if(rainbowCheckbox.checked){

                    color = `hsl(${x1}, 100%, 50%)`;
                }
                event.preventDefault();
                canvasContext.lineCap = "round";
                canvasContext.lineJoin = "round";
                context.beginPath();
                context.strokeStyle = color;
                context.lineWidth = lineSelect.value;
                context.moveTo(x1, y1);
                context.lineTo(x2, y2);
                context.stroke();
                context.closePath();
            }

            function stopDrawing(){
                event.preventDefault();
                console.log("stopDrawing works");
                if(isDrawing){
                    isDrawing = !isDrawing;
                }
            };


        </script>
    </body>

</html>