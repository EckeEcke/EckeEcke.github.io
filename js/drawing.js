const colorSelect=document.getElementById("color-select"),lineSelect=document.getElementById("line-width"),saveButton=document.getElementById("save-button"),downloadButton=document.getElementById("download-button"),drawButton=document.getElementById("draw-button"),deleteButton=document.getElementById("delete-button"),eraseButton=document.getElementById("erase-button"),bucketButton=document.getElementById("bucket-button"),canvas=document.getElementById("game-canvas"),canvasContext=canvas.getContext("2d");let p1X,p1Y,isErasing=!1,isDrawing=!1,startedDrawing=!1,isBucketMode=!1,drawings;fetch("https://drawings-backend.vercel.app/api/getDrawings").then(t=>t.json()).then(t=>drawings=t).then(()=>{displayDrawingsGallery()}).catch();const initialize=()=>{setCanvasSize(),canvasContext.fillStyle="white",canvasContext.fillRect(0,0,canvas.width,canvas.height),window.addEventListener("resize",initialize),window.addEventListener("orientationchange",initialize),canvas.addEventListener("mousedown",setDrawing),canvas.addEventListener("mousemove",draw),canvas.addEventListener("touchstart",setDrawing),canvas.addEventListener("touchmove",draw),canvas.addEventListener("mouseup",stopDrawing),canvas.addEventListener("mouseleave",stopDrawing),canvas.addEventListener("touchend",stopDrawing),saveButton.addEventListener("click",saveDrawing),downloadButton.addEventListener("click",downloadDrawing),deleteButton.addEventListener("click",deleteDrawing),drawButton.addEventListener("click",toggleDraw),eraseButton.addEventListener("click",toggleErase),bucketButton.addEventListener("click",toggleBucket)};window.onload=()=>{initialize(),canvasContext.fillStyle="#643579",canvasContext.font="40px myFont",canvasContext.textAlign="center",canvasContext.fillText("Drawing App",canvas.width/2,canvas.height/2-20),canvasContext.font="20px myFont",canvasContext.fillText("Tap or click to start",canvas.width/2,canvas.height/2+20),canvasContext.font="40px Tahoma",canvasContext.fillText("\u{1F3A8}\u{1F58C}\uFE0F",canvas.width/2,canvas.height/2+90),canvasContext.lineCap="round",canvasContext.lineJoin="round",document.getElementById("gallery-button").addEventListener("click",toggleDisplay),document.getElementById("drawing-button").addEventListener("click",toggleDisplay)};function toggleDisplay(){document.getElementById("gallery-wrapper").classList.toggle("hidden"),document.getElementById("wrapper").classList.toggle("hidden"),document.getElementById("gallery-button").classList.toggle("active"),document.getElementById("drawing-button").classList.toggle("active")}const setCanvasSize=()=>{canvas.width=window.innerWidth<400?.8*window.innerWidth:400,canvas.height=window.innerWidth<400?window.innerWidth:500,window.innerWidth<800&&window.innerWidth/window.innerHeight>.7&&(canvas.width=window.innerWidth*.8,canvas.height=window.innerWidth)},saveDrawing=()=>{confirm("Do you want to post your drawing in the drawings gallery?")&&(fetch("https://drawings-backend.vercel.app/api/postDrawing",{method:"post",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({image:canvas.toDataURL(),createdAt:new Date().toISOString(),creator:"Chris"})}).then(n=>n.json()).then(()=>{document.getElementById("upload-success-toast").classList.remove("inactive"),setTimeout(()=>document.getElementById("upload-success-toast").classList.add("inactive"),2e3)}).catch(n=>{document.getElementById("upload-fail-toast").classList.remove("inactive"),setTimeout(()=>document.getElementById("upload-fail-toast").classList.add("inactive"),2e3),console.log(n)}),drawings.push({image:canvas.toDataURL(),createdAt:new Date().toISOString(),creator:"Chris"}),displayDrawingsGallery(),toggleDisplay(),saveButton.disabled=!0)},downloadDrawing=()=>{const t=canvas.toDataURL("image/png"),n=document.createElement("a");n.href=t,n.download="drawing.png",document.body.appendChild(n),n.click(),document.body.removeChild(n)},deleteDrawing=()=>{saveButton.disabled=!0,downloadButton.disabled=!0,canvasContext.fillStyle="white",canvasContext.fillRect(0,0,canvas.width,canvas.height)},toggleBucket=()=>{isBucketMode=!isBucketMode,bucketButton.style.opacity=isBucketMode?"1":"0.3",isErasing=!1,eraseButton.style.opacity="0.3",drawButton.style.opacity=isBucketMode?"0.3":"1"},setDrawing=t=>{t.preventDefault(),startedDrawing||initialize(),startedDrawing=!0,saveButton.disabled=!1,downloadButton.disabled=!1;const n=Math.floor(t.targetTouches?t.targetTouches[0].pageX-canvas.offsetLeft:t.offsetX),a=Math.floor(t.targetTouches?t.targetTouches[0].pageY-canvas.offsetTop:t.offsetY);if(isBucketMode){let o=colorSelect.value;floodFill(n,a,o);return}isDrawing=!0,p1X=n,p1Y=a,canvasContext.beginPath()},draw=t=>{if(t.preventDefault(),!isBucketMode&&isDrawing){const n=t.targetTouches?t.targetTouches[0].pageX-canvas.offsetLeft:t.offsetX,a=t.targetTouches?t.targetTouches[0].pageY-canvas.offsetTop:t.offsetY;drawLine(n,a),p1X=n,p1Y=a}},toggleDraw=()=>{drawButton.style.opacity="1",isErasing=!1,isBucketMode=!1,eraseButton.style.opacity="0.3",bucketButton.style.opacity="0.3"},toggleErase=()=>{isErasing=!isErasing,eraseButton.style.opacity=isErasing?"1":"0.3",isBucketMode=!1,drawButton.style.opacity="0.3",bucketButton.style.opacity="0.3",drawButton.style.opacity="0.3"},drawLine=(t,n)=>{let a=colorSelect.value;isErasing&&(a="white"),canvasContext.strokeStyle=a,canvasContext.lineWidth=lineSelect.value;const o=(p1X+t)/2,s=(p1Y+n)/2;canvasContext.quadraticCurveTo(p1X,p1Y,o,s),canvasContext.stroke()},stopDrawing=t=>{t&&t.preventDefault(),isDrawing&&(isDrawing=!1),canvasContext.closePath()},floodFill=(t,n,a)=>{const o=canvasContext.getImageData(0,0,canvas.width,canvas.height),s=o.data,c=o.width,E=o.height,u=(n*c+t)*4,f=s[u],w=s[u+1],m=s[u+2],v=s[u+3];let d,l,r,b=255;if(a==="white")d=l=r=255;else if(a.startsWith("#")){const e=a.replace("#","");e.length===3?(d=parseInt(e.charAt(0)+e.charAt(0),16),l=parseInt(e.charAt(1)+e.charAt(1),16),r=parseInt(e.charAt(2)+e.charAt(2),16)):(d=parseInt(e.substring(0,2),16),l=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16))}else if(a.startsWith("hsl")){const g=document.createElement("canvas").getContext("2d");g.fillStyle=a,g.fillRect(0,0,1,1);const h=g.getImageData(0,0,1,1).data;d=h[0],l=h[1],r=h[2]}if(Math.abs(f-d)<5&&Math.abs(w-l)<5&&Math.abs(m-r)<5)return;const p=10,i=[];i.push(u);const y=new Set;for(;i.length>0;){const e=i.pop();if(y.has(e))continue;y.add(e);const g=Math.floor(e/4%c),h=Math.floor(e/4/c),L=s[e],I=s[e+1],D=s[e+2],B=s[e+3];Math.abs(L-f)<=p&&Math.abs(I-w)<=p&&Math.abs(D-m)<=p&&Math.abs(B-v)<=p&&(s[e]=d,s[e+1]=l,s[e+2]=r,s[e+3]=b,g>0&&i.push(e-4),g<c-1&&i.push(e+4),h>0&&i.push(e-c*4),h<E-1&&i.push(e+c*4))}canvasContext.putImageData(o,0,0)},displayDrawingsGallery=()=>{const t=document.getElementById("drawings-gallery");t.innerHTML="",[...drawings].sort((a,o)=>new Date(o.createdAt)-new Date(a.createdAt)).forEach(a=>{const o=new Image;o.src=a.image,t.appendChild(o)})};
