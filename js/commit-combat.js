const GH_SANS=["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Helvetica","Arial","sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"'],GH_MONO=["ui-monospace","SFMono-Regular","SF Mono","Menlo","Consolas",'"Liberation Mono"',"monospace"],setupLauncher=()=>{const y=document.getElementById("game-container");if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768){const n=document.createElement("div");n.style.cssText=`position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:#2d333b; padding:30px; border-radius:8px; color:white; font-family:${GH_SANS.join(",")}; text-align:center; border:2px solid #ff4444; width:80%`,n.innerHTML='<h2 style="color:#ff4444; margin-top:0">PC Required</h2><p>This game requires a keyboard and a larger screen to play.</p><p style="font-size:12px; color:#8b949e">Please open this page on a Desktop computer.</p>',y.appendChild(n);return}const P=document.createElement("div");P.id="ui-overlay",P.style.cssText=`position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:#2d333b; padding:20px; border-radius:8px; display:flex; flex-direction:column; gap:10px; color:white; font-family:${GH_SANS.join(",")}; z-index:100; border:2px solid #39d353`;const i=document.createElement("div");i.style.cssText="background:#22272e; padding:15px; border-radius:6px; font-size:13px; border:1px solid #444c56",i.innerHTML=`
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #444c56; padding-bottom:10px">
            <div style="text-align:center; flex:1">
                <strong style="color:#39d353">P1 (Green)</strong><br>Move: A / D<br>Shoot: W
            </div>
            <div style="width:1px; background:#444c56; margin:0 10px"></div>
            <div style="text-align:center; flex:1">
                <strong style="color:#ff4444">P2 (Red)</strong><br>Move: \u2190 / \u2192<br>Shoot: \u2193
            </div>
        </div>
        <div style="text-align:center; color:#8b949e">
            <strong>Goal:</strong> First to 10 Hits or most hits after 1:00 min wins!
        </div>
    `;const p=document.createElement("h2");p.innerText="Commit Combat",p.style.cssText="margin:0 0 10px 0; text-align:center";const r=document.createElement("input");r.placeholder="Enter github user name",r.style.cssText="padding:8px; border-radius:4px; border:1px solid #444c56; background:#22272e; color:white";const g=document.createElement("input");g.placeholder="Enter github user name",g.style.cssText="padding:8px; border-radius:4px; border:1px solid #444c56; background:#22272e; color:white";const s=document.createElement("div");s.style.cssText="display:flex; justify-content:space-around; padding:10px 4px 10px 0; background:#22272e; border-radius:4px";const u=(n,v,m)=>{const x=document.createElement("label");x.style.cursor="pointer";const d=document.createElement("input");return d.style.cssText="accent-color: red",d.type="radio",d.name="mode",d.value=n,d.checked=m,x.append(d," "+v),x};s.append(u("cpu","1 player",!0),u("pvp","2 player",!1));const I=document.createElement("button");I.innerText="START BATTLE",I.style.cssText="padding:10px; background:#39d353; border:none; border-radius:4px; cursor:pointer; font-weight:bold",P.append(p,i,r,g,s,i,I),y.appendChild(P),I.onclick=()=>{const n=r.value.trim()||"EckeEcke",v=g.value.trim()||"torvalds",m=document.querySelector('input[name="mode"]:checked').value;P.remove(),showPreGameScreen(n,v,m)}},showPreGameScreen=async(y,k,P)=>{const i=new PIXI.Application,p=400,r=400,g=Math.max(window.devicePixelRatio,2);await i.init({background:"#1a1a1a",antialias:!0,resizeTo:window,resolution:g,autoDensity:!0}),document.getElementById("game-container").appendChild(i.canvas);const s=new PIXI.Container;i.stage.addChild(s);const u=()=>{const x=window.innerWidth,d=window.innerHeight,w=Math.min(x/p,d/r);s.scale.set(w),s.x=(x-p*w)/2,s.y=(d-r*w)/2};window.addEventListener("resize",u),u();const I=(x,d,w=!0)=>{const X=new PIXI.Text({text:x,resolution:g,style:{fontFamily:GH_SANS,fontSize:d,fontWeight:w?"bold":"normal",fill:"#ffffff",stroke:{color:"#ffffff",width:.2},align:"center",wordWrap:!0,wordWrapWidth:120}});return X.roundPixels=!0,X},n=async(x,d,w,X)=>{const E=new PIXI.Container;E.position.set(d,w),s.addChild(E);const W=new PIXI.Graphics().roundRect(-42,-42,84,84,8).stroke({width:3,color:X});E.addChild(W);try{const G=new Image;G.crossOrigin="anonymous",G.src=`https://eckeecke.pythonanywhere.com/image-proxy/${x}`,await new Promise(A=>G.onload=A);const H=new PIXI.Sprite(PIXI.Texture.from(G));H.anchor.set(.5),H.width=80,H.height=80;const R=new PIXI.Graphics().roundRect(-40,-40,80,80,6).fill(16777215);H.mask=R,E.addChild(R,H)}catch{}const b=I(x,18);b.anchor.set(.5),b.y=65,E.addChild(b)};await Promise.all([n(y,100,150,3789651),n(k,300,150,16729156)]);const v=I("VS",40);v.style.fill="#39d353",v.anchor.set(.5),v.position.set(200,150),s.addChild(v);const m=I("CLICK TO FIGHT",20);m.anchor.set(.5),m.position.set(200,300),s.addChild(m),s.eventMode="static",s.hitArea=i.screen,s.once("pointerdown",()=>{window.removeEventListener("resize",u),setTimeout(()=>{i.canvas&&i.canvas.parentNode&&i.canvas.parentNode.removeChild(i.canvas),i.destroy(!0,{children:!0,texture:!0}),initGame(y,k,P)},50)})},initGame=async(y,k,P)=>{const i={a:!1,d:!1,w:!1,arrowleft:!1,arrowright:!1,arrowdown:!1};window.addEventListener("keydown",o=>{const t=o.key.toLowerCase();i.hasOwnProperty(t)&&(i[t]=!0)}),window.addEventListener("keyup",o=>{const t=o.key.toLowerCase();i.hasOwnProperty(t)&&(i[t]=!1)});const p=new PIXI.Application,r=300,g=120,s=r+g,u=400,I=Math.max(window.devicePixelRatio,2);await p.init({background:"#1a1a1a",antialias:!0,resizeTo:window,resolution:I,autoDensity:!0}),document.getElementById("game-container").appendChild(p.canvas);const n=new PIXI.Container;p.stage.addChild(n);const v=()=>{const o=window.innerWidth,t=window.innerHeight,c=Math.min(o/s,t/u);n.scale.set(c),n.x=(o-s*c)/2,n.y=(t-u*c)/2};window.addEventListener("resize",v),v();const m=(o,t,c=!0,h="#ffffff",e=!1)=>{const l=new PIXI.Text({text:o,resolution:I,style:{fontFamily:e?GH_MONO:GH_SANS,fontSize:t,fontWeight:c?"bold":"normal",fill:h,stroke:{color:h,width:.2},wordWrap:!0,wordWrapWidth:g-10}});return l.roundPixels=!0,l},x=new PIXI.Graphics().rect(r,0,g,u).fill({color:0,alpha:.5});n.addChild(x);let d=0,w=0,X=0,E=0,W=60,b=!1,G=0,H=0;const R=400,A=m("01:00",24,!0,"#39d353",!0);A.position.set(r+5,180),n.addChild(A);const j=m(k,14);j.position.set(r+5,20),n.addChild(j);const z=m("Hits: 0",12,!1,"#aaaaaa",!0);z.position.set(r+5,45),n.addChild(z);const q=m(y,14);q.position.set(r+5,320),n.addChild(q);const N=m("Hits: 0",12,!1,"#aaaaaa",!0);N.position.set(r+5,345),n.addChild(N);const U=o=>{if(b)return;let t="";if(d>=10?t=y:w>=10?t=k:o==="time"&&(d>w?t=y:w>d?t=k:X>E?t=y:E>X&&(t=k)),t||o==="time"){b=!0,clearInterval(K);const c=new PIXI.Graphics().rect(0,0,s,u).fill({color:0,alpha:.8}),h=t?`${t}
WINS!`:"DRAW",e=m(h,30,!0,"#39d353");e.style.align="center",e.anchor.set(.5),e.position.set(s/2,u/2),n.addChild(c,e),setTimeout(()=>window.location.reload(),2e3)}},K=setInterval(()=>{if(b)return clearInterval(K);W--;const o=Math.floor(W/60),t=W%60;A.text=`${o.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`,W<=0&&(A.text="00:00",U("time"))},1e3),V=(o,t,c)=>{for(let h=0;h<8;h++){const e=new PIXI.Graphics().rect(0,0,3,3).fill(c);e.x=o,e.y=t;const l=Math.random()*Math.PI*2,S=Math.random()*2+1,C=Math.cos(l)*S,M=Math.sin(l)*S;n.addChild(e);const a=()=>{e.x+=C,e.y+=M,e.alpha-=.03,e.alpha<=0&&(n.removeChild(e),p.ticker.remove(a))};p.ticker.add(a)}},Q=(o,t)=>{if(b)return;V(o.x,o.y,t?3789651:16729156),t?(d++,N.text=`Hits: ${d}`):(w++,z.text=`Hits: ${w}`),U("hits");const c=new PIXI.ColorMatrixFilter;o.filters=[c],c.negative(),setTimeout(()=>o.filters=[],100)},B=new PIXI.Container,_=new PIXI.Container;n.addChild(B,_);const T=new PIXI.Container;T.position.set(r/2,380),n.addChild(T);const f=new PIXI.Container;f.position.set(r/2,20),n.addChild(f);let J=1;const $=o=>o<=0?2962235:[934953,27954,2532929,3789651][Math.min(3,Math.max(0,Math.ceil(o/3)-1))],F=(o,t,c,h)=>{if(b)return;const e=new PIXI.Graphics().circle(0,0,4).fill(h?16729156:16776960);e.x=o,e.y=t,n.addChild(e);const l=()=>{e.y+=c;const S=h?T:f;if(Math.hypot(e.x-S.x,e.y-S.y)<15){Q(S,!h),n.removeChild(e),p.ticker.remove(l);return}const C=h?_:B,M=(r-70)/7;C.children.forEach(a=>{a.visible&&e.x+4>a.x+C.x&&e.x-4<a.x+C.x+M&&e.y>a.y+C.y&&e.y<a.y+C.y+M&&(a.lives--,V(e.x,e.y,$(a.lives+1)),a.lives<0?(a.visible=!1,h?E++:X++):a.clear().roundRect(0,0,M,M,6).fill($(a.lives)),n.removeChild(e),p.ticker.remove(l))}),(e.y<0||e.y>u)&&(n.removeChild(e),p.ticker.remove(l))};p.ticker.add(l)};try{const t=await(await fetch(`https://eckeecke.pythonanywhere.com/get-battle/${y}/${k}`)).json(),c=(r-70)/7,h=(l,S,C)=>{l.position.set(20,C),S.forEach((M,a)=>M.forEach((L,D)=>{const O=new PIXI.Graphics().roundRect(0,0,c,c,6).fill($(L));O.x=D*(c+6),O.y=a*(c+6),O.lives=L,l.addChild(O)}))};h(B,t.enemy.shield_grid,50),h(_,t.player.shield_grid,280);const e=async(l,S,C)=>{const M=new PIXI.Graphics().roundRect(-13,-13,26,26,4).stroke({width:2,color:C?16729156:3789651});l.addChild(M);const a=new Image;a.crossOrigin="anonymous",a.src=`https://eckeecke.pythonanywhere.com/image-proxy/${S}`,await new Promise(O=>a.onload=O);const L=new PIXI.Sprite(PIXI.Texture.from(a));L.anchor.set(.5),L.width=24,L.height=24;const D=new PIXI.Graphics().roundRect(-12,-12,24,24,3).fill(16777215);L.mask=D,l.addChild(D,L)};if(await Promise.all([e(T,y,!1),e(f,k,!0)]),P==="cpu"){const l=()=>{b||(F(f.x,f.y+15,5,!0),setTimeout(l,Math.random()*600+400))};l()}}catch{}p.ticker.add(()=>{if(b)return;i.a&&(T.x-=4),i.d&&(T.x+=4),T.x=Math.max(20,Math.min(r-20,T.x));const o=Date.now();P==="pvp"?(i.arrowleft&&(f.x-=4),i.arrowright&&(f.x+=4),f.x=Math.max(20,Math.min(r-20,f.x)),i.arrowdown&&o-H>R&&(F(f.x,f.y+15,5,!0),H=o)):(f.x+=2*J,(f.x>r-20||f.x<20)&&(J*=-1)),i.w&&o-G>R&&(F(T.x,T.y-15,-5,!1),G=o)})};setupLauncher();
