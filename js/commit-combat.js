const GH_SANS=["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Helvetica","Arial","sans-serif",'"Apple Color Emoji"','"Segoe UI Emoji"'],GH_MONO=["ui-monospace","SFMono-Regular","SF Mono","Menlo","Consolas",'"Liberation Mono"',"monospace"],setupLauncher=()=>{const y=document.getElementById("game-container"),p=document.createElement("div");p.id="ui-overlay",p.style.cssText=`position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:#2d333b; padding:20px; border-radius:8px; display:flex; flex-direction:column; gap:10px; color:white; font-family:${GH_SANS.join(",")}; z-index:100; border:2px solid #39d353`;const X=document.createElement("h2");X.innerText="Commit Combat",X.style.cssText="margin:0 0 10px 0; text-align:center";const a=document.createElement("input");a.placeholder="Enter github user name",a.style.cssText="padding:8px; border-radius:4px; border:1px solid #444c56; background:#22272e; color:white";const h=document.createElement("input");h.placeholder="Enter github user name",h.style.cssText="padding:8px; border-radius:4px; border:1px solid #444c56; background:#22272e; color:white";const i=document.createElement("div");i.style.cssText="display:flex; justify-content:space-around; padding:10px 4px 10px 0; background:#22272e; border-radius:4px";const T=(u,C,o)=>{const I=document.createElement("label");I.style.cursor="pointer";const c=document.createElement("input");return c.style.cssText="accent-color: red",c.type="radio",c.name="mode",c.value=u,c.checked=o,I.append(c," "+C),I};i.append(T("cpu","1 player",!0),T("pvp","2 player",!1));const s=document.createElement("button");s.innerText="START BATTLE",s.style.cssText="padding:10px; background:#39d353; border:none; border-radius:4px; cursor:pointer; font-weight:bold",p.append(X,a,h,i,s),y.appendChild(p),s.onclick=()=>{const u=a.value.trim()||"EckeEcke",C=h.value.trim()||"torvalds",o=document.querySelector('input[name="mode"]:checked').value;p.remove(),showPreGameScreen(u,C,o)}},showPreGameScreen=async(y,p,X)=>{const a=new PIXI.Application,h=400,i=400,T=Math.max(window.devicePixelRatio,2);await a.init({background:"#1a1a1a",antialias:!0,resizeTo:window,resolution:T,autoDensity:!0}),document.getElementById("game-container").appendChild(a.canvas);const s=new PIXI.Container;a.stage.addChild(s);const u=()=>{const E=window.innerWidth,x=window.innerHeight,w=Math.min(E/h,x/i);s.scale.set(w),s.x=(E-h*w)/2,s.y=(x-i*w)/2};window.addEventListener("resize",u),u();const C=(E,x,w=!0)=>{const M=new PIXI.Text({text:E,resolution:T,style:{fontFamily:GH_SANS,fontSize:x,fontWeight:w?"bold":"normal",fill:"#ffffff",stroke:{color:"#ffffff",width:.2},align:"center",wordWrap:!0,wordWrapWidth:120}});return M.roundPixels=!0,M},o=async(E,x,w,M)=>{const k=new PIXI.Container;k.position.set(x,w),s.addChild(k);const H=new PIXI.Graphics().roundRect(-42,-42,84,84,8).stroke({width:3,color:M});k.addChild(H);try{const L=new Image;L.crossOrigin="anonymous",L.src=`https://eckeecke.pythonanywhere.com/image-proxy/${E}`,await new Promise(A=>L.onload=A);const G=new PIXI.Sprite(PIXI.Texture.from(L));G.anchor.set(.5),G.width=80,G.height=80;const R=new PIXI.Graphics().roundRect(-40,-40,80,80,6).fill(16777215);G.mask=R,k.addChild(R,G)}catch{}const g=C(E,18);g.anchor.set(.5),g.y=65,k.addChild(g)};await Promise.all([o(y,100,150,3789651),o(p,300,150,16729156)]);const I=C("VS",40);I.style.fill="#39d353",I.anchor.set(.5),I.position.set(200,150),s.addChild(I);const c=C("CLICK TO FIGHT",20);c.anchor.set(.5),c.position.set(200,300),s.addChild(c),s.eventMode="static",s.hitArea=a.screen,s.once("pointerdown",()=>{window.removeEventListener("resize",u),setTimeout(()=>{a.canvas&&a.canvas.parentNode&&a.canvas.parentNode.removeChild(a.canvas),a.destroy(!0,{children:!0,texture:!0}),initGame(y,p,X)},50)})},initGame=async(y,p,X)=>{const a={a:!1,d:!1,w:!1,arrowleft:!1,arrowright:!1,arrowdown:!1};window.addEventListener("keydown",n=>{const t=n.key.toLowerCase();a.hasOwnProperty(t)&&(a[t]=!0)}),window.addEventListener("keyup",n=>{const t=n.key.toLowerCase();a.hasOwnProperty(t)&&(a[t]=!1)});const h=new PIXI.Application,i=300,T=120,s=i+T,u=400,C=Math.max(window.devicePixelRatio,2);await h.init({background:"#1a1a1a",antialias:!0,resizeTo:window,resolution:C,autoDensity:!0}),document.getElementById("game-container").appendChild(h.canvas);const o=new PIXI.Container;h.stage.addChild(o);const I=()=>{const n=window.innerWidth,t=window.innerHeight,d=Math.min(n/s,t/u);o.scale.set(d),o.x=(n-s*d)/2,o.y=(t-u*d)/2};window.addEventListener("resize",I),I();const c=(n,t,d=!0,f="#ffffff",e=!1)=>{const l=new PIXI.Text({text:n,resolution:C,style:{fontFamily:e?GH_MONO:GH_SANS,fontSize:t,fontWeight:d?"bold":"normal",fill:f,stroke:{color:f,width:.2},wordWrap:!0,wordWrapWidth:T-10}});return l.roundPixels=!0,l},E=new PIXI.Graphics().rect(i,0,T,u).fill({color:0,alpha:.5});o.addChild(E);let x=0,w=0,M=0,k=0,H=60,g=!1,L=0,G=0;const R=400,A=c("01:00",24,!0,"#39d353",!0);A.position.set(i+5,180),o.addChild(A);const q=c(p,14);q.position.set(i+5,20),o.addChild(q);const $=c("Hits: 0",12,!1,"#aaaaaa",!0);$.position.set(i+5,45),o.addChild($);const D=c("S: 0",10,!1,"#666666",!0);D.position.set(i+70,45),o.addChild(D);const K=c(y,14);K.position.set(i+5,320),o.addChild(K);const _=c("Hits: 0",12,!1,"#aaaaaa",!0);_.position.set(i+5,345),o.addChild(_);const z=c("S: 0",10,!1,"#666666",!0);z.position.set(i+70,345),o.addChild(z);const V=n=>{if(g)return;let t="";if(x>=10?t=y:w>=10?t=p:n==="time"&&(x>w?t=y:w>x?t=p:M>k?t=y:k>M&&(t=p)),t||n==="time"){g=!0,clearInterval(J);const d=new PIXI.Graphics().rect(0,0,s,u).fill({color:0,alpha:.8}),f=t?`${t}
WINS!`:"DRAW",e=c(f,30,!0,"#39d353");e.style.align="center",e.anchor.set(.5),e.position.set(s/2,u/2),o.addChild(d,e),setTimeout(()=>window.location.reload(),2e3)}},J=setInterval(()=>{if(g)return clearInterval(J);H--;const n=Math.floor(H/60),t=H%60;A.text=`${n.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`,H<=0&&(A.text="00:00",V("time"))},1e3),Q=(n,t,d)=>{for(let f=0;f<8;f++){const e=new PIXI.Graphics().rect(0,0,3,3).fill(d);e.x=n,e.y=t;const l=Math.random()*Math.PI*2,S=Math.random()*2+1,v=Math.cos(l)*S,P=Math.sin(l)*S;o.addChild(e);const r=()=>{e.x+=v,e.y+=P,e.alpha-=.03,e.alpha<=0&&(o.removeChild(e),h.ticker.remove(r))};h.ticker.add(r)}},Z=(n,t)=>{if(g)return;Q(n.x,n.y,t?3789651:16729156),t?(x++,_.text=`Hits: ${x}`):(w++,$.text=`Hits: ${w}`),V("hits");const d=new PIXI.ColorMatrixFilter;n.filters=[d],d.negative(),setTimeout(()=>n.filters=[],100)},B=new PIXI.Container,F=new PIXI.Container;o.addChild(B,F);const b=new PIXI.Container;b.position.set(i/2,380),o.addChild(b);const m=new PIXI.Container;m.position.set(i/2,20),o.addChild(m);let Y=1;const j=n=>[2962235,934953,27954,2532929,3789651][Math.min(4,Math.floor(n/3))],U=(n,t,d,f)=>{if(g)return;const e=new PIXI.Graphics().circle(0,0,4).fill(f?16729156:16776960);e.x=n,e.y=t,o.addChild(e);const l=()=>{e.y+=d;const S=f?b:m;if(Math.hypot(e.x-S.x,e.y-S.y)<15){Z(S,!f),o.removeChild(e),h.ticker.remove(l);return}const v=f?F:B,P=(i-70)/7;v.children.forEach(r=>{r.visible&&e.x+4>r.x+v.x&&e.x-4<r.x+v.x+P&&e.y>r.y+v.y&&e.y<r.y+v.y+P&&(r.lives--,Q(e.x,e.y,j(r.lives+1)),r.lives<=0?(r.visible=!1,f?(M++,D.text=`S: ${M}`):(k++,z.text=`S: ${k}`)):r.clear().roundRect(0,0,P,P,6).fill(j(r.lives)),o.removeChild(e),h.ticker.remove(l))}),(e.y<0||e.y>u)&&(o.removeChild(e),h.ticker.remove(l))};h.ticker.add(l)};try{const t=await(await fetch(`https://eckeecke.pythonanywhere.com/get-battle/${y}/${p}`)).json(),d=(i-70)/7,f=(l,S,v)=>{l.position.set(20,v),S.forEach((P,r)=>P.forEach((W,N)=>{const O=new PIXI.Graphics().roundRect(0,0,d,d,6).fill(j(W));O.x=N*(d+6),O.y=r*(d+6),O.lives=W,l.addChild(O)}))};f(B,t.enemy.shield_grid,50),f(F,t.player.shield_grid,280);const e=async(l,S,v)=>{const P=new PIXI.Graphics().roundRect(-13,-13,26,26,4).stroke({width:2,color:v?16729156:3789651});l.addChild(P);const r=new Image;r.crossOrigin="anonymous",r.src=`https://eckeecke.pythonanywhere.com/image-proxy/${S}`,await new Promise(O=>r.onload=O);const W=new PIXI.Sprite(PIXI.Texture.from(r));W.anchor.set(.5),W.width=24,W.height=24;const N=new PIXI.Graphics().roundRect(-12,-12,24,24,3).fill(16777215);W.mask=N,l.addChild(N,W)};if(await Promise.all([e(b,y,!1),e(m,p,!0)]),X==="cpu"){const l=()=>{g||(U(m.x,m.y+15,5,!0),setTimeout(l,Math.random()*600+400))};l()}}catch{}h.ticker.add(()=>{if(g)return;a.a&&(b.x-=4),a.d&&(b.x+=4),b.x=Math.max(20,Math.min(i-20,b.x));const n=Date.now();X==="pvp"?(a.arrowleft&&(m.x-=4),a.arrowright&&(m.x+=4),m.x=Math.max(20,Math.min(i-20,m.x)),a.arrowdown&&n-G>R&&(U(m.x,m.y+15,5,!0),G=n)):(m.x+=2*Y,(m.x>i-20||m.x<20)&&(Y*=-1)),a.w&&n-L>R&&(U(b.x,b.y-15,-5,!1),L=n)})};setupLauncher();
