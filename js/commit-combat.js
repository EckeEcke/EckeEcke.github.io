const GH_SANS=["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Helvetica","Arial","sans-serif"],GH_MONO=["ui-monospace","SFMono-Regular","SF Mono","Menlo","Consolas","monospace"],setupLauncher=()=>{const C=document.getElementById("game-container");if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768){const x=document.createElement("div");x.style.cssText=`position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:#2d333b; padding:30px; border-radius:8px; color:white; font-family:${GH_SANS.join(",")}; text-align:center; border:2px solid #ff4444; width:80%`,x.innerHTML='<h2 style="color:#ff4444; margin-top:0">PC Required</h2><p>This game requires a keyboard and a larger screen to play.</p>',C.appendChild(x);return}const g=document.createElement("div");g.id="ui-overlay",g.style.cssText=`position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:#2d333b; padding:20px; border-radius:8px; display:flex; flex-direction:column; gap:10px; color:white; font-family:${GH_SANS.join(",")}; z-index:100; border:2px solid #39d353`;const X=document.createElement("h2");X.innerText="Commit Combat",X.style.margin="0 0 10px 0",X.style.textAlign="center";const i=document.createElement("div");i.style.cssText="background:#22272e; padding:15px; border-radius:6px; font-size:13px; border:1px solid #444c56",i.innerHTML=`
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #444c56; padding-bottom:10px">
            <div style="text-align:center; flex:1">
                <strong style="color:#39d353">P1 (Green)</strong><br>Move: A / D<br>Shoot: W
            </div>
            <div style="width:1px; background:#444c56; margin:0 10px"></div>
            <div style="text-align:center; flex:1">
                <strong style="color:#ff4444">P2 (Red)</strong><br>Move: \u2190 / \u2192<br>Shoot: \u2193
            </div>
        </div>
        <div style="text-align:center; color:#8b949e">
            Goal: First to 10 Hits or most hits after 1:00 min wins!
        </div>
    `;const c=document.createElement("input");c.placeholder="Enter github user name",c.style.cssText="padding:8px; border-radius:4px; border:1px solid #444c56; background:#22272e; color:white";const r=document.createElement("input");r.placeholder="Enter github user name",r.style.cssText="padding:8px; border-radius:4px; border:1px solid #444c56; background:#22272e; color:white";const S=document.createElement("div");S.style.cssText="display:flex; justify-content:space-around; padding:10px; background:#22272e; border-radius:4px";const u=(x,o,k)=>{const f=document.createElement("label");f.style.cursor="pointer";const h=document.createElement("input");return h.type="radio",h.name="mode",h.value=x,h.checked=k,f.append(h," "+o),f};S.append(u("cpu","1 player",!0),u("pvp","2 player",!1));const a=document.createElement("button");a.innerText="START BATTLE",a.style.cssText="padding:10px; background:#39d353; border:none; border-radius:4px; cursor:pointer; font-weight:bold",g.append(X,i,c,r,S,a),C.appendChild(g),a.onclick=async()=>{const x=c.value.trim()||"EckeEcke",o=r.value.trim()||"torvalds",k=document.querySelector('input[name="mode"]:checked').value;a.disabled=!0,a.innerText="CHECKING USERS...",a.style.background="#8b949e";try{const f=await fetch(`https://eckeecke.pythonanywhere.com/get-battle/${x}/${o}`),h=await f.json();if(!f.ok){alert(`BATTLE ERROR:
${h.message||"Users not found"}`),c.value="",r.value="",a.disabled=!1,a.innerText="START BATTLE",a.style.background="#39d353";return}g.remove(),showPreGameScreen(x,o,k,h)}catch{alert("Network Error: Could not connect to battle server."),a.disabled=!1,a.innerText="START BATTLE",a.style.background="#39d353"}}},showPreGameScreen=async(C,E,g,X)=>{const i=new PIXI.Application,c=400,r=400,S=Math.max(window.devicePixelRatio,2);await i.init({background:"#1a1a1a",antialias:!0,resizeTo:window,resolution:S,autoDensity:!0}),document.getElementById("game-container").appendChild(i.canvas);const u=new PIXI.Container;i.stage.addChild(u);const a=()=>{const h=window.innerWidth,v=window.innerHeight,y=Math.min(h/c,v/r);u.scale.set(y),u.x=(h-c*y)/2,u.y=(v-r*y)/2};window.addEventListener("resize",a),a();const x=(h,v,y=!0)=>{const H=new PIXI.Text({text:h,resolution:S,style:{fontFamily:GH_SANS,fontSize:v,fontWeight:y?"bold":"normal",fill:"#ffffff"}});return H.roundPixels=!0,H},o=async(h,v,y,H)=>{const M=new PIXI.Container;M.position.set(v,y),u.addChild(M);const R=new PIXI.Graphics().roundRect(-42,-42,84,84,8).stroke({width:3,color:H});M.addChild(R);try{const G=new Image;G.crossOrigin="anonymous",G.src=`https://eckeecke.pythonanywhere.com/image-proxy/${h}`,await new Promise((A,N)=>{G.onload=A,G.onerror=N});const T=new PIXI.Sprite(PIXI.Texture.from(G));T.anchor.set(.5),T.width=80,T.height=80;const O=new PIXI.Graphics().roundRect(-40,-40,80,80,6).fill(16777215);T.mask=O,M.addChild(O,T)}catch{const T=x(h[0].toUpperCase(),40);T.anchor.set(.5),M.addChild(T)}const I=x(h,18);I.anchor.set(.5),I.y=65,M.addChild(I)};await Promise.all([o(C,100,150,3789651),o(E,300,150,16729156)]);const k=x("VS",40);k.style.fill="#39d353",k.anchor.set(.5),k.position.set(200,150),u.addChild(k);const f=x("CLICK TO FIGHT",20);f.anchor.set(.5),f.position.set(200,300),u.addChild(f),u.eventMode="static",u.hitArea=i.screen,u.once("pointerdown",()=>{window.removeEventListener("resize",a),setTimeout(()=>{i.canvas&&i.canvas.parentNode&&i.canvas.parentNode.removeChild(i.canvas),i.destroy(!0,{children:!0,texture:!0}),initGame(C,E,g,X)},50)})},initGame=async(C,E,g,X)=>{const i={a:!1,d:!1,w:!1,arrowleft:!1,arrowright:!1,arrowdown:!1};window.addEventListener("keydown",n=>{const t=n.key.toLowerCase();i.hasOwnProperty(t)&&(i[t]=!0)}),window.addEventListener("keyup",n=>{const t=n.key.toLowerCase();i.hasOwnProperty(t)&&(i[t]=!1)});const c=new PIXI.Application,r=300,S=120,u=r+S,a=400,x=Math.max(window.devicePixelRatio,2);await c.init({background:"#1a1a1a",antialias:!0,resizeTo:window,resolution:x,autoDensity:!0}),document.getElementById("game-container").appendChild(c.canvas);const o=new PIXI.Container;c.stage.addChild(o);const k=()=>{const n=window.innerWidth,t=window.innerHeight,s=Math.min(n/u,t/a);o.scale.set(s),o.x=(n-u*s)/2,o.y=(t-a*s)/2};window.addEventListener("resize",k),k();const f=(n,t,s=!0,p="#ffffff",e=!1)=>{const l=new PIXI.Text({text:n,resolution:x,style:{fontFamily:e?GH_MONO:GH_SANS,fontSize:t,fontWeight:s?"bold":"normal",fill:p,wordWrap:!0,wordWrapWidth:S-10}});return l.roundPixels=!0,l},h=new PIXI.Graphics().rect(r,0,S,a).fill({color:0,alpha:.5});o.addChild(h);let v=0,y=0,H=0,M=0,R=60,I=!1,G=0,T=0;const O=400;let A=0,N=1;const $=f("01:00",24,!0,"#39d353",!0);$.position.set(r+5,180),o.addChild($);const U=f(E,14);U.position.set(r+5,20),o.addChild(U);const z=f("Hits: 0",12,!1,"#aaaaaa",!0);z.position.set(r+5,45),o.addChild(z);const q=f(C,14);q.position.set(r+5,320),o.addChild(q);const D=f("Hits: 0",12,!1,"#aaaaaa",!0);D.position.set(r+5,345),o.addChild(D);const K=n=>{if(I)return;let t="";if(v>=10?t=C:y>=10?t=E:n==="time"&&(v>y?t=C:y>v?t=E:H>M?t=C:M>H&&(t=E)),t||n==="time"){I=!0,clearInterval(V),g==="cpu"&&clearInterval(J);const s=new PIXI.Graphics().rect(0,0,u,a).fill({color:0,alpha:.8}),p=t?`${t}
WINS!`:"DRAW",e=f(p,30,!0,"#39d353");e.style.align="center",e.anchor.set(.5),e.position.set(u/2,a/2),o.addChild(s,e),setTimeout(()=>window.location.reload(),4e3)}},V=setInterval(()=>{if(I)return clearInterval(V);R--;const n=Math.floor(R/60),t=R%60;$.text=`${n.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`,R<=0&&($.text="00:00",K("time"))},1e3),J=g==="cpu"?setInterval(()=>{if(I)return clearInterval(J);A=(A+1)%3},3e3):null,Q=(n,t,s)=>{for(let p=0;p<8;p++){const e=new PIXI.Graphics().rect(0,0,3,3).fill(s);e.x=n,e.y=t;const l=Math.random()*Math.PI*2,P=Math.random()*2+1,m=Math.cos(l)*P,L=Math.sin(l)*P;o.addChild(e);const w=()=>{e.x+=m,e.y+=L,e.alpha-=.03,e.alpha<=0&&(o.removeChild(e),c.ticker.remove(w))};c.ticker.add(w)}},ee=(n,t)=>{if(I)return;Q(n.x,n.y,t?3789651:16729156),t?(v++,D.text=`Hits: ${v}`):(y++,z.text=`Hits: ${y}`),K("hits");const s=new PIXI.ColorMatrixFilter;n.filters=[s],s.negative(),setTimeout(()=>n.filters=[],100)},_=new PIXI.Container,W=new PIXI.Container;o.addChild(_,W);const b=new PIXI.Container;b.position.set(r/2,380),o.addChild(b);const d=new PIXI.Container;d.position.set(r/2,20),o.addChild(d);const F=n=>n<=0?2962235:[934953,27954,2532929,3789651][Math.min(3,Math.max(0,Math.ceil(n/3)-1))],j=(n,t,s,p)=>{if(I)return;const e=new PIXI.Graphics().circle(0,0,4).fill(p?16729156:16776960);e.x=n,e.y=t,o.addChild(e);const l=()=>{e.y+=s;const P=p?b:d;if(Math.hypot(e.x-P.x,e.y-P.y)<15){ee(P,!p),o.removeChild(e),c.ticker.remove(l);return}const m=p?W:_,L=(r-70)/7;m.children.forEach(w=>{w.visible&&e.x+4>w.x+m.x&&e.x-4<w.x+m.x+L&&e.y>w.y+m.y&&e.y<w.y+m.y+L&&(w.lives--,Q(e.x,e.y,F(w.lives+1)),w.lives<0?(w.visible=!1,p?M++:H++):w.clear().roundRect(0,0,L,L,6).fill(F(w.lives)),o.removeChild(e),c.ticker.remove(l))}),(e.y<0||e.y>a)&&(o.removeChild(e),c.ticker.remove(l))};c.ticker.add(l)},B=(r-70)/7,Y=(n,t,s)=>{n.position.set(20,s),t.forEach((p,e)=>p.forEach((l,P)=>{const m=new PIXI.Graphics().roundRect(0,0,B,B,6).fill(F(l));m.x=P*(B+6),m.y=e*(B+6),m.lives=l,n.addChild(m)}))};Y(_,X.enemy.shield_grid,50),Y(W,X.player.shield_grid,280);const Z=async(n,t,s)=>{const p=new PIXI.Graphics().roundRect(-13,-13,26,26,4).stroke({width:2,color:s?16729156:3789651});n.addChild(p);try{const e=new Image;e.crossOrigin="anonymous",e.src=`https://eckeecke.pythonanywhere.com/image-proxy/${t}`,await new Promise((m,L)=>{e.onload=m,e.onerror=L});const l=new PIXI.Sprite(PIXI.Texture.from(e));l.anchor.set(.5),l.width=24,l.height=24;const P=new PIXI.Graphics().roundRect(-12,-12,24,24,3).fill(16777215);l.mask=P,n.addChild(P,l)}catch{const l=f(t[0].toUpperCase(),14,!0,s?"#ff4444":"#39d353");l.anchor.set(.5),n.addChild(l)}};if(await Promise.all([Z(b,C,!1),Z(d,E,!0)]),g==="cpu"){const n=()=>{I||(j(d.x,d.y+15,5,!0),setTimeout(n,Math.random()*600+400))};n()}c.ticker.add(()=>{if(I)return;i.a&&(b.x-=4),i.d&&(b.x+=4),b.x=Math.max(20,Math.min(r-20,b.x));const n=Date.now();if(g==="pvp")i.arrowleft&&(d.x-=4),i.arrowright&&(d.x+=4),d.x=Math.max(20,Math.min(r-20,d.x)),i.arrowdown&&n-T>O&&(j(d.x,d.y+15,5,!0),T=n);else{if(A===0)d.x+=2*N,(d.x>r-20||d.x<20)&&(N*=-1);else if(A===1){const t=b.x-d.x;Math.abs(t)>5&&(d.x+=t>0?2.5:-2.5)}else if(A===2){const t=W.children.filter(s=>s.visible);if(t.length>0){const p=t[0].x+W.x+B/2-d.x;Math.abs(p)>5&&(d.x+=p>0?2:-2)}else{const s=b.x-d.x;d.x+=s>0?2:-2}}d.x=Math.max(20,Math.min(r-20,d.x))}i.w&&n-G>O&&(j(b.x,b.y-15,-5,!1),G=n)})};setupLauncher();
