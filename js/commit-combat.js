const GH_SANS=["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Helvetica","Arial","sans-serif"],GH_MONO=["ui-monospace","SFMono-Regular","SF Mono","Menlo","Consolas","monospace"],setupLauncher=()=>{const v=document.getElementById("game-container");if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768){const f=document.createElement("div");f.style.cssText=`position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:#2d333b; padding:30px; border-radius:8px; color:white; font-family:${GH_SANS.join(",")}; text-align:center; border:2px solid #ff4444; width:80%`,f.innerHTML='<h2 style="color:#ff4444; margin-top:0">PC Required</h2><p>This game requires a keyboard and a larger screen to play.</p>',v.appendChild(f);return}const T=document.createElement("div");T.id="ui-overlay",T.style.cssText=`position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:#2d333b; padding:20px; border-radius:8px; display:flex; flex-direction:column; gap:10px; color:white; font-family:${GH_SANS.join(",")}; z-index:100; border:2px solid #39d353`;const X=document.createElement("h2");X.innerText="Commit Combat",X.style.margin="0 0 10px 0",X.style.textAlign="center";const i=document.createElement("div");i.style.cssText="background:#22272e; padding:15px; border-radius:6px; font-size:13px; border:1px solid #444c56",i.innerHTML=`
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #444c56; padding-bottom:10px">
            <div style="text-align:center; flex:1">
                <strong style="color:#39d353">P1 (Green)</strong><br>Move: A / D<br>Shoot: W
            </div>
            <div style="width:1px; background:#444c56; margin:0 10px"></div>
            <div style="text-align:center; flex:1">
                <strong style="color:#ff4444">P2 (Red)</strong><br>Move: \u2190 / \u2192<br>Shoot: \u2193
            </div>
        </div>
        <div style="text-align:center; color:#8b949e">
            Goal: First to 10 Hits or most hits after 1:00 min wins!
        </div>
    `;const d=document.createElement("input");d.placeholder="Enter github user name",d.style.cssText="padding:8px; border-radius:4px; border:1px solid #444c56; background:#22272e; color:white";const a=document.createElement("input");a.placeholder="Enter github user name",a.style.cssText="padding:8px; border-radius:4px; border:1px solid #444c56; background:#22272e; color:white";const P=document.createElement("div");P.style.cssText="display:flex; justify-content:space-around; padding:10px; background:#22272e; border-radius:4px";const h=(f,o,b)=>{const l=document.createElement("label");l.style.cursor="pointer";const c=document.createElement("input");return c.type="radio",c.name="mode",c.value=f,c.checked=b,l.append(c," "+o),l};P.append(h("cpu","1 player",!0),h("pvp","2 player",!1));const r=document.createElement("button");r.innerText="START BATTLE",r.style.cssText="padding:10px; background:#39d353; border:none; border-radius:4px; cursor:pointer; font-weight:bold",T.append(X,i,d,a,P,r),v.appendChild(T),r.onclick=async()=>{const f=d.value.trim()||"EckeEcke",o=a.value.trim()||"torvalds",b=document.querySelector('input[name="mode"]:checked').value;r.disabled=!0,r.innerText="CHECKING USERS...",r.style.background="#8b949e";try{const l=await fetch(`https://eckeecke.pythonanywhere.com/get-battle/${f}/${o}`),c=await l.json();if(!l.ok){alert(`BATTLE ERROR:
${c.message||"Users not found"}`),d.value="",a.value="",r.disabled=!1,r.innerText="START BATTLE",r.style.background="#39d353";return}T.remove(),showPreGameScreen(f,o,b,c)}catch{alert("Network Error: Could not connect to battle server."),r.disabled=!1,r.innerText="START BATTLE",r.style.background="#39d353"}}},showPreGameScreen=async(v,M,T,X)=>{const i=new PIXI.Application,d=400,a=400,P=Math.max(window.devicePixelRatio,2);await i.init({background:"#1a1a1a",antialias:!0,resizeTo:window,resolution:P,autoDensity:!0}),document.getElementById("game-container").appendChild(i.canvas);const h=new PIXI.Container;i.stage.addChild(h);const r=()=>{const c=window.innerWidth,g=window.innerHeight,y=Math.min(c/d,g/a);h.scale.set(y),h.x=(c-d*y)/2,h.y=(g-a*y)/2};window.addEventListener("resize",r),r();const f=(c,g,y=!0)=>{const H=new PIXI.Text({text:c,resolution:P,style:{fontFamily:GH_SANS,fontSize:g,fontWeight:y?"bold":"normal",fill:"#ffffff"}});return H.roundPixels=!0,H},o=async(c,g,y,H)=>{const S=new PIXI.Container;S.position.set(g,y),h.addChild(S);const A=new PIXI.Graphics().roundRect(-42,-42,84,84,8).stroke({width:3,color:H});S.addChild(A);try{const G=new Image;G.crossOrigin="anonymous",G.src=`https://eckeecke.pythonanywhere.com/image-proxy/${c}`,await new Promise((R,W)=>{G.onload=R,G.onerror=W});const C=new PIXI.Sprite(PIXI.Texture.from(G));C.anchor.set(.5),C.width=80,C.height=80;const O=new PIXI.Graphics().roundRect(-40,-40,80,80,6).fill(16777215);C.mask=O,S.addChild(O,C)}catch{const C=f(c[0].toUpperCase(),40);C.anchor.set(.5),S.addChild(C)}const I=f(c,18);I.anchor.set(.5),I.y=65,S.addChild(I)};await Promise.all([o(v,100,150,3789651),o(M,300,150,16729156)]);const b=f("VS",40);b.style.fill="#39d353",b.anchor.set(.5),b.position.set(200,150),h.addChild(b);const l=f("CLICK TO FIGHT",20);l.anchor.set(.5),l.position.set(200,300),h.addChild(l),h.eventMode="static",h.hitArea=i.screen,h.once("pointerdown",()=>{window.removeEventListener("resize",r),setTimeout(()=>{i.canvas&&i.canvas.parentNode&&i.canvas.parentNode.removeChild(i.canvas),i.destroy(!0,{children:!0,texture:!0}),initGame(v,M,T,X)},50)})},initGame=async(v,M,T,X)=>{const i={a:!1,d:!1,w:!1,arrowleft:!1,arrowright:!1,arrowdown:!1};window.addEventListener("keydown",t=>{const n=t.key.toLowerCase();i.hasOwnProperty(n)&&(i[n]=!0)}),window.addEventListener("keyup",t=>{const n=t.key.toLowerCase();i.hasOwnProperty(n)&&(i[n]=!1)});const d=new PIXI.Application,a=300,P=120,h=a+P,r=400,f=Math.max(window.devicePixelRatio,2);await d.init({background:"#1a1a1a",antialias:!0,resizeTo:window,resolution:f,autoDensity:!0}),document.getElementById("game-container").appendChild(d.canvas);const o=new PIXI.Container;d.stage.addChild(o);const b=()=>{const t=window.innerWidth,n=window.innerHeight,p=Math.min(t/h,n/r);o.scale.set(p),o.x=(t-h*p)/2,o.y=(n-r*p)/2};window.addEventListener("resize",b),b();const l=(t,n,p=!0,u="#ffffff",e=!1)=>{const s=new PIXI.Text({text:t,resolution:f,style:{fontFamily:e?GH_MONO:GH_SANS,fontSize:n,fontWeight:p?"bold":"normal",fill:u,wordWrap:!0,wordWrapWidth:P-10}});return s.roundPixels=!0,s},c=new PIXI.Graphics().rect(a,0,P,r).fill({color:0,alpha:.5});o.addChild(c);let g=0,y=0,H=0,S=0,A=60,I=!1,G=0,C=0;const O=400,R=l("01:00",24,!0,"#39d353",!0);R.position.set(a+5,180),o.addChild(R);const W=l(M,14);W.position.set(a+5,20),o.addChild(W);const N=l("Hits: 0",12,!1,"#aaaaaa",!0);N.position.set(a+5,45),o.addChild(N);const j=l(v,14);j.position.set(a+5,320),o.addChild(j);const $=l("Hits: 0",12,!1,"#aaaaaa",!0);$.position.set(a+5,345),o.addChild($);const U=t=>{if(I)return;let n="";if(g>=10?n=v:y>=10?n=M:t==="time"&&(g>y?n=v:y>g?n=M:H>S?n=v:S>H&&(n=M)),n||t==="time"){I=!0,clearInterval(q);const p=new PIXI.Graphics().rect(0,0,h,r).fill({color:0,alpha:.8}),u=n?`${n}
WINS!`:"DRAW",e=l(u,30,!0,"#39d353");e.style.align="center",e.anchor.set(.5),e.position.set(h/2,r/2),o.addChild(p,e),setTimeout(()=>window.location.reload(),4e3)}},q=setInterval(()=>{if(I)return clearInterval(q);A--;const t=Math.floor(A/60),n=A%60;R.text=`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`,A<=0&&(R.text="00:00",U("time"))},1e3),K=(t,n,p)=>{for(let u=0;u<8;u++){const e=new PIXI.Graphics().rect(0,0,3,3).fill(p);e.x=t,e.y=n;const s=Math.random()*Math.PI*2,k=Math.random()*2+1,x=Math.cos(s)*k,L=Math.sin(s)*k;o.addChild(e);const w=()=>{e.x+=x,e.y+=L,e.alpha-=.03,e.alpha<=0&&(o.removeChild(e),d.ticker.remove(w))};d.ticker.add(w)}},Y=(t,n)=>{if(I)return;K(t.x,t.y,n?3789651:16729156),n?(g++,$.text=`Hits: ${g}`):(y++,N.text=`Hits: ${y}`),U("hits");const p=new PIXI.ColorMatrixFilter;t.filters=[p],p.negative(),setTimeout(()=>t.filters=[],100)},z=new PIXI.Container,D=new PIXI.Container;o.addChild(z,D);const E=new PIXI.Container;E.position.set(a/2,380),o.addChild(E);const m=new PIXI.Container;m.position.set(a/2,20),o.addChild(m);let V=1;const _=t=>t<=0?2962235:[934953,27954,2532929,3789651][Math.min(3,Math.max(0,Math.ceil(t/3)-1))],F=(t,n,p,u)=>{if(I)return;const e=new PIXI.Graphics().circle(0,0,4).fill(u?16729156:16776960);e.x=t,e.y=n,o.addChild(e);const s=()=>{e.y+=p;const k=u?E:m;if(Math.hypot(e.x-k.x,e.y-k.y)<15){Y(k,!u),o.removeChild(e),d.ticker.remove(s);return}const x=u?D:z,L=(a-70)/7;x.children.forEach(w=>{w.visible&&e.x+4>w.x+x.x&&e.x-4<w.x+x.x+L&&e.y>w.y+x.y&&e.y<w.y+x.y+L&&(w.lives--,K(e.x,e.y,_(w.lives+1)),w.lives<0?(w.visible=!1,u?S++:H++):w.clear().roundRect(0,0,L,L,6).fill(_(w.lives)),o.removeChild(e),d.ticker.remove(s))}),(e.y<0||e.y>r)&&(o.removeChild(e),d.ticker.remove(s))};d.ticker.add(s)},B=(a-70)/7,J=(t,n,p)=>{t.position.set(20,p),n.forEach((u,e)=>u.forEach((s,k)=>{const x=new PIXI.Graphics().roundRect(0,0,B,B,6).fill(_(s));x.x=k*(B+6),x.y=e*(B+6),x.lives=s,t.addChild(x)}))};J(z,X.enemy.shield_grid,50),J(D,X.player.shield_grid,280);const Q=async(t,n,p)=>{const u=new PIXI.Graphics().roundRect(-13,-13,26,26,4).stroke({width:2,color:p?16729156:3789651});t.addChild(u);try{const e=new Image;e.crossOrigin="anonymous",e.src=`https://eckeecke.pythonanywhere.com/image-proxy/${n}`,await new Promise((x,L)=>{e.onload=x,e.onerror=L});const s=new PIXI.Sprite(PIXI.Texture.from(e));s.anchor.set(.5),s.width=24,s.height=24;const k=new PIXI.Graphics().roundRect(-12,-12,24,24,3).fill(16777215);s.mask=k,t.addChild(k,s)}catch{const s=l(n[0].toUpperCase(),14,!0,p?"#ff4444":"#39d353");s.anchor.set(.5),t.addChild(s)}};if(await Promise.all([Q(E,v,!1),Q(m,M,!0)]),T==="cpu"){const t=()=>{I||(F(m.x,m.y+15,5,!0),setTimeout(t,Math.random()*600+400))};t()}d.ticker.add(()=>{if(I)return;i.a&&(E.x-=4),i.d&&(E.x+=4),E.x=Math.max(20,Math.min(a-20,E.x));const t=Date.now();T==="pvp"?(i.arrowleft&&(m.x-=4),i.arrowright&&(m.x+=4),m.x=Math.max(20,Math.min(a-20,m.x)),i.arrowdown&&t-C>O&&(F(m.x,m.y+15,5,!0),C=t)):(m.x+=2*V,(m.x>a-20||m.x<20)&&(V*=-1)),i.w&&t-G>O&&(F(E.x,E.y-15,-5,!1),G=t)})};setupLauncher();
